# ast-grepå®Œå…¨ã‚¬ã‚¤ãƒ‰ - ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™

## å…±é€šãƒ«ãƒ¼ãƒ«
- èª‡å¼µè¡¨ç¾,éåº¦ãªè£…é£¾ã¯é¿ã‘ã‚‹ã€äº‹å®Ÿã«åŸºã¥ãèª¬æ˜ã‚’å¿ƒãŒã‘ã‚‹
- å®Ÿã‚³ãƒ¼ãƒ‰ã‚’ä½¿ãˆ - æ¶ç©ºã§ã¯ãªãå®Ÿåœ¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰
- å†ç¾å¯èƒ½ã§ã‚ã‚Œ - å®Ÿéš›ã«å‹•ä½œã™ã‚‹ã‚‚ã®ã ã‘
- æ®µéšçš„ã«æ§‹æˆã›ã‚ˆ - ç°¡å˜â†’è¤‡é›‘ã®é †åº
- å…·ä½“ä¾‹ã§ç¤ºã› - ãƒ“ãƒ•ã‚©ãƒ¼ãƒ»ã‚¢ãƒ•ã‚¿ãƒ¼ã‚’æ˜ç¤º
- å†’é™ºã¨ã‹ã€å¤‰ãªæ¯”å–©ã¨ã‹ã€å›ºæœ‰ã®è¡¨ç¾ã‚’è¨­ã‘ã‚‹ã“ã¨ã¯é¿ã‘ã¦ãã ã•ã„ã€‚æŠ€è¡“çš„ãªèª¬æ˜ã«é›†ä¸­ã—ã¾ã™
- ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå´©ã‚Œã«ã¯ç‰¹ã«æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„

---

## Page 1: ã‚¿ã‚¤ãƒˆãƒ«ã‚¹ãƒ©ã‚¤ãƒ‰

### é€Ÿç¿’ ast-grep
**æ§‹æ–‡æœ¨ãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ„ãƒ¼ãƒ«**

- prettierã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§å­¦ã¶å®Ÿè·µçš„ãªä½¿ã„æ–¹
- å¾“æ¥ã®æ¤œç´¢æ‰‹æ³•ã¨ã®æ¯”è¼ƒ
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¸ã®å¿œç”¨

---

## Page 2: ã‚¢ã‚¸ã‚§ãƒ³ãƒ€

### æœ¬æ—¥ã®å†…å®¹

1. **å¾“æ¥ã®æ¤œç´¢æ‰‹æ³•**
2. **ast-grepã¨ã¯ä½•ã‹**
3. **åŸºæœ¬çš„ãªä½¿ã„æ–¹**
4. **å®Ÿè·µä¾‹1: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜æ¤œç´¢**
5. **å®Ÿè·µä¾‹2: APIä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º**
6. **å®Ÿè·µä¾‹3: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ”¯æ´**
7. **é«˜åº¦ãªæ´»ç”¨æ³•**
8. **ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**

---

## Page 3: æ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ã®æ¤œç´¢

### æ–‡å­—åˆ—æ¤œç´¢ (grep)

```bash
$ grep "isNode" src/
```

**ç‰¹æ€§:**
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä¾å­˜
- ã‚³ãƒ¡ãƒ³ãƒˆã‚„æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã‚‚æ¤œå‡º
- ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ ã¯è€ƒæ…®ã—ãªã„

```javascript
// ã™ã¹ã¦ãƒãƒƒãƒã™ã‚‹
isNode(node, ["type"])           // â† æ¤œç´¢å¯¾è±¡
// isNode is deprecated          // â† ã‚³ãƒ¡ãƒ³ãƒˆ
const text = "isNode function"  // â† æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«
```

---

## Page 4: æ­£è¦è¡¨ç¾æ¤œç´¢

### æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æ¤œç´¢

```bash
$ grep -E "isNode\(.*\[.*\]\)" src/
```

**ç‰¹æ€§:**
- æ”¹è¡Œã‚’è·¨ããƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¯å¯¾å¿œã—ã¥ã‚‰ã„
- ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã®è¡¨ç¾ãŒè¤‡é›‘
- ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé•·ããªã‚‹å‚¾å‘

```javascript
// ãƒãƒƒãƒã™ã‚‹
isNode(node, ["type1", "type2"])

// ãƒãƒƒãƒã—ãªã„
isNode(node, [
  "type1",
  "type2"
])
```

---

## Page 5: ast-grep

æ§‹æ–‡æœ¨ãƒ™ãƒ¼ã‚¹ã®æ¤œç´¢ãƒ„ãƒ¼ãƒ«

**AST (Abstract Syntax Tree) = æŠ½è±¡æ§‹æ–‡æœ¨**

```
isNode(node, ["type"])
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
 call_expr
    â”œâ”€ identifier: "isNode"
    â”œâ”€ arg[0]: identifier "node"
    â””â”€ arg[1]: array
         â””â”€ string: "type"
```

**ast-grep ã¯ã‚³ãƒ¼ãƒ‰ã‚’æ§‹æ–‡æœ¨ã¨ã—ã¦æ‰±ã†**

---

## Page 6: æ¤œç´¢æ–¹å¼ã®æ¯”è¼ƒè¡¨

| æ–¹å¼ | é€Ÿåº¦ | ç²¾åº¦ | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜ | æ§‹é€ ç†è§£ |
|------|------|------|-------------------|---------|
| **grep** | é«˜ | ä½ | éå¯¾å¿œ | éå¯¾å¿œ |
| **æ­£è¦è¡¨ç¾** | ä¸­ | ä¸­ | éƒ¨åˆ†çš„ | éå¯¾å¿œ |
| **ast-grep** | ä½ | é«˜ | å¯¾å¿œ | å¯¾å¿œ |

**ast-grepã®ç”¨é€”:**
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
- æ§‹é€ çš„ãªç½®æ›

---

## Page 7: ast-grepã®åŸºæœ¬ - ãƒ¡ã‚¿å¤‰æ•°

### ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®è¨˜æ³•

| ãƒ¡ã‚¿å¤‰æ•° | èª¬æ˜ | ä½¿ç”¨ä¾‹ |
|---------|------|--------|
| `$VAR` | å˜ä¸€ãƒãƒ¼ãƒ‰ã«ãƒãƒƒãƒ | `$VAR.method()` |
| `$$$` | 0å€‹ä»¥ä¸Šã®ãƒãƒ¼ãƒ‰ã«ãƒãƒƒãƒ | `func($$$)` |
| `$$MULTI` | åå‰ä»˜ãè¤‡æ•°ãƒãƒ¼ãƒ‰ | `func($$ARGS)` |

**ä¾‹:**
```javascript
// ãƒ‘ã‚¿ãƒ¼ãƒ³: console.$METHOD($$$)
console.log("hello")        // ãƒãƒƒãƒ
console.error("error", e)   // ãƒãƒƒãƒ
console.warn()              // ãƒãƒƒãƒ
```

---

## Page 8: åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

### ã‚ˆãä½¿ã†3ã¤ã®ã‚³ãƒãƒ³ãƒ‰

**1. ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œç´¢**
```bash
ast-grep --lang js --pattern 'PATTERN' [ãƒ•ã‚¡ã‚¤ãƒ«]
```

**2. ç½®æ›ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰**
```bash
ast-grep --pattern 'OLD' --rewrite 'NEW' [ãƒ•ã‚¡ã‚¤ãƒ«]
```

**3. YAMLãƒ«ãƒ¼ãƒ«ã§æ¤œç´¢**
```bash
ast-grep scan --rule rule.yml [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]
```

---

## Page 9: å®Ÿè·µä¾‹1 - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜æ¤œç´¢

### ç•°ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã‚³ãƒ¼ãƒ‰æ¤œå‡º

**prettierã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã®å®Ÿä¾‹:**

```javascript
// ãƒ‘ã‚¿ãƒ¼ãƒ³1: 1è¡Œ
isNode(node, ["sequence", "mapping"])

// ãƒ‘ã‚¿ãƒ¼ãƒ³2: è¤‡æ•°è¡Œãƒ»ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ
isNode(node, [
  "documentHead",
  "documentBody",
  "flowMapping",
  "flowSequence",
])

// ãƒ‘ã‚¿ãƒ¼ãƒ³3: ã‚¹ãƒšãƒ¼ã‚¹ãªã—
isNode(node,["type"])
```

**æ§‹é€ çš„ã«ã¯åŒä¸€**

---

## Page 10: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜æ¤œç´¢ - grepã®å ´åˆ

### grepã§è©¦ã—ã¦ã¿ã‚‹ã¨...

```bash
$ grep "isNode.*\[" src/language-yaml/
```

**çµæœ:**
```
âœ… isNode(node, ["sequence", "mapping"])
âœ… isNode(node,["type"])
âŒ isNode(node, [     # è¤‡æ•°è¡Œã¯æ¤œå‡ºã§ããªã„
```

**å•é¡Œ:**
- æ”¹è¡Œã‚’è·¨ããƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã§ããªã„
- æ­£è¦è¡¨ç¾ã‚’è¤‡é›‘ã«ã—ã¦ã‚‚é™ç•ŒãŒã‚ã‚‹

---

## Page 11: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜æ¤œç´¢ - ast-grepã®å ´åˆ

### ast-grepãªã‚‰æ§‹é€ ã§æ¤œç´¢

```bash
$ ast-grep --lang js --pattern 'isNode($NODE, [$$$])' src/language-yaml/
```

**çµæœ:**
```
âœ… isNode(node, ["sequence", "mapping"])
âœ… isNode(node, [
     "documentHead",
     "documentBody",
     ...
   ])
âœ… isNode(node,["type"])
```

**ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ¤œå‡º!**

---

## Page 12: å®Ÿéš›ã®æ¤œå‡ºçµæœ

### prettierãƒªãƒã‚¸ãƒˆãƒªã§ã®å®Ÿè¡Œçµæœ

```
src/language-yaml/print/misc.js:32:
    !isNode(node, [
      "documentHead",
      "documentBody",
      "flowMapping",
      "flowSequence",
    ])

src/language-yaml/printer-yaml.js:83:
    if (isNode(node, ["sequence", "mapping"]) && ...)

src/language-yaml/printer-yaml.js:115:
    if (... && !isNode(node, ["document", "documentHead"]))
```

**æ¤œå‡ºä»¶æ•°: 10ç®‡æ‰€ä»¥ä¸Š**

---

## Page 13: å®Ÿè·µä¾‹2 - APIä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º

### èª²é¡Œ: ç‰¹å®šã®APIãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹

**prettierã§ã®å®Ÿä¾‹: ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã®æ¤œå‡º**

```javascript
// src/language-yaml/printer-yaml.js ã‚ˆã‚Š
const DEBUG = node.type === 'plain' && node.value === 'key';
if (DEBUG) console.error('\nğŸ”µ Starting...');

if (node.type !== "mappingValue" && hasLeadingComments(node)) {
  if (DEBUG) console.error('  â• [é ˜åŸŸ1] leadingComments');
  parts.push(...);
}

// ... ã•ã‚‰ã«10ç®‡æ‰€ä»¥ä¸Šç¶šã
```

**ç›®çš„: ã“ã®ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬æ¤œå‡ºã—ãŸã„**

---

## Page 14: ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰æ¤œå‡º - ã‚³ãƒãƒ³ãƒ‰

### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ¤œç´¢

```bash
$ ast-grep --pattern 'if ($DEBUG) console.$METHOD($$$)' \
    src/language-yaml/printer-yaml.js
```

**æ¤œå‡ºçµæœ:**
```
âœ… Line 84:  if (DEBUG) console.error('  â• [é ˜åŸŸ3+] ...');
âœ… Line 87:  if (DEBUG) console.error('  â• [é ˜åŸŸ3+] ...');
âœ… Line 93:  if (DEBUG) console.error('  â• [é ˜åŸŸ4] ...');
âœ… Line 102: if (DEBUG) console.error('  â• [é ˜åŸŸ5] ...');
âœ… Line 111: if (DEBUG) console.error('  â• [é ˜åŸŸ5] ...');
âœ… Line 116: if (DEBUG) console.error('  â• [é ˜åŸŸ6] ...');
âœ… Line 131: if (DEBUG) console.error('  â• [é ˜åŸŸ7] ...');
âœ… Line 151: if (DEBUG) console.error('  â• [é ˜åŸŸ8] ...');
```

---

## Page 15: YAMLãƒ«ãƒ¼ãƒ«ã§é«˜åº¦ãªæ¤œç´¢

### ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã‚’ä»˜åŠ 

```yaml
# debug-rule.yml
id: find-debug-console
language: js
rule:
  pattern: if ($DEBUG) console.$METHOD($$$)
message: Debug console statement found
severity: warning
```

**å®Ÿè¡Œ:**
```bash
$ ast-grep scan --rule debug-rule.yml src/
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- é‡è¦åº¦ã‚’è¨­å®š
- è¤‡æ•°ãƒ«ãƒ¼ãƒ«ã‚’ç®¡ç†ã—ã‚„ã™ã„

---

## Page 16: å®Ÿè·µä¾‹3 - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ”¯æ´

### èª²é¡Œ: å¤ã„æ§‹æ–‡ã‚’æ–°ã—ã„æ§‹æ–‡ã«

**é…åˆ—ã®æœ€å¾Œã®è¦ç´ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**

```javascript
// å¤ã„ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆES5ï¼‰
arr[arr.length - 1]
items[items.length - 1]

// æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆES2022ï¼‰
arr.at(-1)
items.at(-1)
```

**prettierã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ã¯ä¸¡æ–¹ãŒæ··åœ¨ã—ã¦ã„ã‚‹!**

---

## Page 17: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å€™è£œã®æ¤œå‡º

### YAMLãƒ«ãƒ¼ãƒ«ã§å¤ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º

```yaml
id: modernize-array-access
language: js
rule:
  any:
    - pattern: $ARR[$ARR.length - 1]
    - pattern: $ARR.slice(-1)[0]
message: Consider using modern array.at(-1) syntax
```

**å®Ÿè¡Œ:**
```bash
$ ast-grep scan --rule modernize-array.yml src/language-yaml/utils.js
```

---

## Page 18: æ¤œå‡ºçµæœã¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### prettier ã® utils.js ã§ã®æ¤œå‡ºçµæœ

```
help[modernize-array-access]:
    â”Œâ”€ src/language-yaml/utils.js:190:7
    â”‚
190 â”‚ lines[lines.length - 1] = [...lines.at(-1), ...words];
    â”‚ ^^^^^^^^^^^^^^^^^^^^^^^

help[modernize-array-access]:
    â”Œâ”€ src/language-yaml/utils.js:250:7
    â”‚
250 â”‚ lines[lines.length - 1] = [...lines.at(-1), ...words];
    â”‚ ^^^^^^^^^^^^^^^^^^^^^^^

help[modernize-array-access]:
    â”Œâ”€ src/language-yaml/utils.js:261:9
    â”‚
261 â”‚ words[words.length - 1] += " " + word;
    â”‚ ^^^^^^^^^^^^^^^^^^^^^^^
```

**3ç®‡æ‰€ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å€™è£œã‚’ç™ºè¦‹!**

---

## Page 19: è‡ªå‹•ç½®æ›ã®å®Ÿè¡Œ

### --rewriteã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ç½®æ›

```bash
$ ast-grep --lang js \
  --pattern '$ARR[$ARR.length - 1]' \
  --rewrite '$ARR.at(-1)' \
  src/language-yaml/utils.js
```

**ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ:**
```diff
- lines[lines.length - 1] = [...lines.at(-1), ...words];
+ lines.at(-1) = [...lines.at(-1), ...words];

- words[words.length - 1] += " " + word;
+ words.at(-1) += " " + word;
```

**`--update-all` ã§å®Ÿéš›ã«é©ç”¨å¯èƒ½**

---

## Page 20: é«˜åº¦ãªä½¿ç”¨ä¾‹ - æ¡ä»¶ã®çµ„ã¿åˆã‚ã›

### any / all / not ã‚’ä½¿ã£ãŸè¤‡é›‘ãªãƒ«ãƒ¼ãƒ«

```yaml
id: complex-pattern
language: js
rule:
  all:
    - pattern: if ($COND) console.$METHOD($$$)
    - not:
        pattern: if (process.env.DEBUG) console.log($$$)
  any:
    - inside:
        pattern: function $FUNC($$$) { $$$ }
message: Non-production console statement found
```

**æ©Ÿèƒ½:**
- `all`: ã™ã¹ã¦ã®æ¡ä»¶ã‚’æº€ãŸã™
- `any`: ã„ãšã‚Œã‹ã®æ¡ä»¶ã‚’æº€ãŸã™
- `not`: æ¡ä»¶ã‚’æº€ãŸã•ãªã„
- `inside`: ç‰¹å®šã®ã‚¹ã‚³ãƒ¼ãƒ—å†…

---

## Page 21: é«˜åº¦ãªä½¿ç”¨ä¾‹ - ã‚¹ã‚³ãƒ¼ãƒ—æ¤œç´¢

### ç‰¹å®šã®é–¢æ•°å†…ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢

```yaml
id: find-in-switch
language: js
rule:
  pattern: |
    switch ($EXPR) {
      $$$
      case "root": { $$$BODY }
      $$$
    }
```

**ä½¿ç”¨ä¾‹:**
- ç‰¹å®šã®switch caseã®å‡¦ç†ã‚’æ¤œç´¢
- é–¢æ•°å†…ã®ç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿æ¤œå‡º
- ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®å‡¦ç†ã‚’æ¤œç´¢

---

## Page 22: ãƒ¡ã‚¿å¤‰æ•°ã®é«˜åº¦ãªæ´»ç”¨

### åŒã˜å¤‰æ•°åã®ç¹°ã‚Šè¿”ã—ã‚’æ¤œå‡º

**ãƒ‘ã‚¿ãƒ¼ãƒ³:**
```javascript
$ARR[$ARR.length - 1]
```

**é‡è¦:** `$ARR` ãŒ2å›å‡ºç¾ = **åŒã˜å¤‰æ•°**ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹

**ãƒãƒƒãƒã™ã‚‹:**
```javascript
lines[lines.length - 1]  // âœ… lines ãŒ2å›
words[words.length - 1]  // âœ… words ãŒ2å›
```

**ãƒãƒƒãƒã—ãªã„:**
```javascript
lines[words.length - 1]  // âŒ ç•°ãªã‚‹å¤‰æ•°
```

---

## Page 23: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®ä¾‹

### è„†å¼±æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º

**Node.jsã§ã®å…¸å‹çš„ãªè„†å¼±æ€§:**

```javascript
// ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
exec('cat ' + userInput, cb);  // å±é™º

// evalä½¿ç”¨
eval(getUserInput());  // å±é™º

// ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«
fs.readFile('./uploads/' + file, cb);  // å±é™º
```

**æ¤œå‡ºãƒ«ãƒ¼ãƒ«ä¾‹:**
```yaml
id: detect-command-injection
language: js
rule:
  pattern: exec($STR + $VAR, $$$)
message: Potential command injection
severity: error
```

---

## Page 24: ast-grepã®ç‰¹å¾´

### ast-grepã®ä¸»ãªç‰¹å¾´

| ç‰¹å¾´ | èª¬æ˜ |
|------|------|
| **é«˜ç²¾åº¦** | ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ ã‚’ç†è§£ã€èª¤æ¤œå‡ºãŒå°‘ãªã„ |
| **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜** | ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ»æ”¹è¡Œã«å·¦å³ã•ã‚Œãªã„ |
| **æ§‹é€ ä¿æŒ** | æ§‹é€ ã‚’ä¿ã£ãŸã¾ã¾å¤‰æ›´å¯èƒ½ |
| **ä¸€æ‹¬å¤‰æ›´** | å¤§è¦æ¨¡ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«å¯¾å¿œ |
| **å¤šè¨€èªå¯¾å¿œ** | JS, TS, Rust, Python, Goç­‰ |

---

## Page 25: ast-grepã®ç‰¹æ€§

### è€ƒæ…®ã™ã¹ãç‰¹æ€§

**ç‰¹æ€§:**
- **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: ãƒ‘ã‚¿ãƒ¼ãƒ³æ§‹æ–‡ã®ç¿’å¾—ãŒå¿…è¦
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§è¦æ¨¡ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯å‡¦ç†æ™‚é–“ãŒã‹ã‹ã‚‹
- **è¨€èªä¾å­˜**: ãƒ‘ãƒ¼ã‚µãƒ¼ãŒå¿…è¦ï¼ˆå¯¾å¿œè¨€èªã¯é™å®šçš„ï¼‰
- **è¤‡é›‘ãªæ§‹é€ **: éå¸¸ã«è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¯è¡¨ç¾ãŒé›£ã—ã„

**ä½¿ã„åˆ†ã‘:**
- ã‚·ãƒ³ãƒ—ãƒ«ãªæ–‡å­—åˆ—æ¤œç´¢ â†’ `grep`
- ã‚³ãƒ¼ãƒ‰æ§‹é€ ã®æ¤œç´¢ãƒ»ç½®æ› â†’ `ast-grep`

---

## Page 26: å®Ÿç”¨ã‚·ãƒ¼ãƒ³åˆ¥ã®ä½¿ã„åˆ†ã‘

### ä½¿ã„åˆ†ã‘ã®åŸºæº–

**ast-grepã®ç”¨é€”:**
- APIå¤‰æ›´ã«ä¼´ã†ã‚³ãƒ¼ãƒ‰æ›´æ–°
- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã®æ¤œæŸ»
- æ§‹æ–‡ã®ç§»è¡Œ
- ç‰¹å®šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€æ‹¬æ¤œå‡º

**grepã®ç”¨é€”:**
- ãƒ•ã‚¡ã‚¤ãƒ«åã®æ¤œç´¢
- æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã®æ¤œç´¢
- å˜ç´”ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
- ãƒ­ã‚°ã®æ¤œç´¢

---

## Page 27: å®Ÿè·µçš„ãªæ´»ç”¨ãƒ•ãƒ­ãƒ¼

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®æ‰‹é †ä¾‹

```
1. ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç‰¹å®š
   â†“
2. ast-grepã§æ¤œç´¢
   â†“
3. æ¤œå‡ºçµæœã®ç¢ºèª
   â†“
4. ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
   â†“
5. --rewriteã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
   â†“
6. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   â†“
7. --update-all ã§é©ç”¨
```

**æ³¨æ„: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ä¸‹ã§ã®å®Ÿè¡Œã‚’æ¨å¥¨**

---

## Page 28: prettierã§ã®å…·ä½“çš„ãªæˆæœ

### æœ¬æ—¥ç´¹ä»‹ã—ãŸæ¤œå‡ºçµæœã¾ã¨ã‚

| ã‚±ãƒ¼ã‚¹ | æ¤œå‡ºæ•° | ãƒ•ã‚¡ã‚¤ãƒ« |
|--------|--------|---------|
| **ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰** | 10+ | `printer-yaml.js` |
| **isNodeå‘¼ã³å‡ºã—** | 10+ | `language-yaml/*` |
| **å¤ã„é…åˆ—ã‚¢ã‚¯ã‚»ã‚¹** | 3 | `utils.js` |
| **å‹ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³** | 1 | `utils.js` |
| **switchæ–‡** | 1 | `printer-yaml.js` |

**ã™ã¹ã¦å®Ÿéš›ã®prettierã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æŠ½å‡º**

---

## Page 29: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç’°å¢ƒæ§‹ç¯‰

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**
```bash
# macOS (Homebrew)
brew install ast-grep

# bun
bun install @ast-grep/cli

# cargo
cargo install ast-grep
```

**å‹•ä½œç¢ºèª:**
```bash
ast-grep --version
```

---

## Page 30: å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

### ã•ã‚‰ã«å­¦ã¶ãŸã‚ã«

**å…¬å¼ãƒªã‚½ãƒ¼ã‚¹:**
- ğŸ“– **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://ast-grep.github.io/
- ğŸ® **Playground**: https://ast-grep.github.io/playground.html
- ğŸ“˜ **ãƒ‘ã‚¿ãƒ¼ãƒ³æ§‹æ–‡ã‚¬ã‚¤ãƒ‰**: https://ast-grep.github.io/guide/pattern-syntax.html
- ğŸ’» **GitHub**: https://github.com/ast-grep/ast-grep

**å®Ÿè·µ:**
- prettierãƒªãƒã‚¸ãƒˆãƒªã§è©¦ã™
- è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿé¨“
- ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆ

---

## Page 31: æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å®Ÿè·µæ–¹æ³•

**1. å‹•ä½œç¢ºèª**
```bash
git clone https://github.com/prettier/prettier.git
cd prettier
ast-grep --lang js --pattern 'console.$METHOD($$$)' src/
```

**2. è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§**
- ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®š
- ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
- CI/CDã«çµ„ã¿è¾¼ã‚€

**3. ãƒãƒ¼ãƒ ã§å…±æœ‰**
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±é€šã®ãƒ«ãƒ¼ãƒ«ä½œæˆ
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ´»ç”¨
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»ã«æ´»ç”¨

---

## Page 32: ã¾ã¨ã‚

### ast-grep ã®è¦ç´„

**ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:**
- **AST (æ§‹æ–‡æœ¨) ãƒ™ãƒ¼ã‚¹ã®æ¤œç´¢**
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜ãƒ»é«˜ç²¾åº¦**
- **æ¤œç´¢ã ã‘ã§ãªãç½®æ›ã‚‚å¯èƒ½**
- **å¤§è¦æ¨¡ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«å¯¾å¿œ**

**åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰:**
```bash
# åŸºæœ¬æ¤œç´¢
ast-grep --pattern 'PATTERN' file

# ç½®æ›
ast-grep --pattern 'OLD' --rewrite 'NEW' file

# ãƒ«ãƒ¼ãƒ«æ¤œç´¢
ast-grep scan --rule rule.yml dir
```
---

## è£œè¶³è³‡æ–™

### prettierã§ã®å®Ÿè¡Œä¾‹ãƒ•ã‚¡ã‚¤ãƒ«

**åŒæ¢±ãƒ•ã‚¡ã‚¤ãƒ«:**
- `ast-grep-examples.sh` - 10å€‹ã®å®Ÿè¡Œå¯èƒ½ãªä¾‹
- `ast-grep-knowledge-base.md` - è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆå…ƒè³‡æ–™ï¼‰

**å®Ÿè¡Œæ–¹æ³•:**
```bash
cd /path/to/prettier
./ast-grep-examples.sh
```

ã™ã¹ã¦ã®ä¾‹ãŒãã®ã¾ã¾å‹•ä½œã—ã¾ã™ã€‚

---

**ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆæ—¥**: 2025-11-22
**ãƒ™ãƒ¼ã‚¹**: prettier main branch
**ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰**: ã™ã¹ã¦å®Ÿåœ¨ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰æŠ½å‡º

